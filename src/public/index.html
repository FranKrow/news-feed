<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel='icon' href='nf.png' type='image/x-icon'/ >
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Pocket-News v1.0</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container-fluid p-4">
      <div class="d-flex justify-content-center hide" id="spinner">
        <div class="spinner-border" role="status">
          <span class="sr-only">Loading...</span>
        </div>
      </div>

      <ul class="nav nav-tabs" id="feedsList" role="tablist"></ul>
      <div class="tab-content" id="feedsContent"></div>
    </div>
    <script type="text/javascript">
      const createFeed = data => {
        const feedList = document.querySelector('#feedsList');
        const feedContent = document.querySelector('#feedsContent');

        for (let index = 0; index < data.length; index++) {
          const feed = data[index];

          // TAB HEADERS
          const feedItem = document.createElement('li');
          feedItem.classList.add('nav-item');
          const feedItemLink = document.createElement('a');
          feedItemLink.classList.add('nav-link');
          if (index === 0) feedItemLink.classList.add('active');
          feedItemLink.href = '#' + feed.source;
          feedItemLink.setAttribute('role', 'tab');
          feedItemLink.textContent = feed.source;
          feedItemLink.setAttribute('data-toggle', 'tab');

          feedItem.appendChild(feedItemLink);
          feedList.appendChild(feedItem);

          // TAB CONTENT
          const feedsNews = document.createElement('div');
          feedsNews.classList.add('tab-pane');
          feedsNews.classList.add('fade');
          if (index === 0) {
            feedsNews.classList.add('show');
            feedsNews.classList.add('active');
          }
          feedsNews.id = feed.source;
          feedsNews.role = 'tabpanel';
          const feedsContainer = document.createElement('div');
          feedsContainer.classList.add('row');
          feedsContainer.classList.add('feedsContainer');
          feedsContainer.setAttribute('role', 'tab');
          for (let j = 0; j < feed.news.length; j++) {
            const n = feed.news[j];

            const col = document.createElement('div');
            const card = document.createElement('div');
            // const cardHeader = document.createElement('div');
            const cardBody = document.createElement('div');
            const image = document.createElement('img');
            const a = document.createElement('a');
            const p = document.createElement('p');
            const pDate = document.createElement('p');
            const small = document.createElement('small');

            p.classList.add('card-text');
            small.classList.add('text-muted');
            col.classList.add('col-md-3');
            card.classList.add('card');
            card.classList.add('bg-light');
            card.classList.add('mb-2');
            // cardHeader.classList.add('card-header');
            cardBody.classList.add('card-body');
            image.classList.add('card-img-top');
            a.classList.add('card-title');
            pDate.classList.add('card-text');

            p.textContent = n.prev;
            small.textContent = n.datePost;
            a.href = n.link;
            a.textContent = n.title;
            a.target = '_blank';
            image.src = n.img;
            // cardBody.textContent = n.prev;
            pDate.appendChild(small);
            cardBody.appendChild(a);
            cardBody.appendChild(p);
            cardBody.appendChild(pDate);
            card.appendChild(image);
            // card.appendChild(cardHeader);
            card.appendChild(cardBody);
            col.appendChild(card);

            feedsContainer.appendChild(col);
          }

          feedsNews.appendChild(feedsContainer);
          feedContent.appendChild(feedsNews);
        }
      };

      /***
       * Make the call to the back
       * */
      const callB = async () => {
        await fetch('/news')
          .then(resp => resp.json())
          .then(res => {
            createFeed(res.data);
          })
          .finally(function() {
            console.log('?');
            const spin = document.getElementById('spinner');
            spin.classList.add('removeSpinner');
          });
      };

      callB();
    </script>

    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
